{% extends 'common/base.html' %}

{% block title %}Seed Bank - CultivAR{% endblock %}

{% block header %}Seed Bank{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Filters and Search -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="flex-grow-1 mr-3">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                </div>
                                <input type="text" class="form-control" id="seed-search" placeholder="Search seeds...">
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="filterDropdown">
                                <h6 class="dropdown-header">Seed Type</h6>
                                <div class="px-4 py-2">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-feminized" checked>
                                        <label class="custom-control-label" for="filter-feminized">Feminized</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-regular" checked>
                                        <label class="custom-control-label" for="filter-regular">Regular</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-autoflower" checked>
                                        <label class="custom-control-label" for="filter-autoflower">Autoflower</label>
                                    </div>
                                </div>
                                <div class="dropdown-divider"></div>
                                <h6 class="dropdown-header">Vendors</h6>
                                <div class="px-4 py-2">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-vendor-all" checked>
                                        <label class="custom-control-label" for="filter-vendor-all">All Vendors</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input vendor-checkbox" id="filter-vendor-1" checked>
                                        <label class="custom-control-label" for="filter-vendor-1">Mephisto Genetics</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input vendor-checkbox" id="filter-vendor-2" checked>
                                        <label class="custom-control-label" for="filter-vendor-2">Barney's Farm</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input vendor-checkbox" id="filter-vendor-3" checked>
                                        <label class="custom-control-label" for="filter-vendor-3">Dutch Passion</label>
                                    </div>
                                </div>
                                <div class="dropdown-divider"></div>
                                <div class="px-4 py-2">
                                    <button class="btn btn-sm btn-primary btn-block" id="apply-filters">Apply Filters</button>
                                </div>
                            </div>
                        </div>
                        <div class="ml-2">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-secondary active" id="view-grid">
                                    <i class="fas fa-th"></i>
                                </button>
                                <button type="button" class="btn btn-outline-secondary" id="view-list">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="mr-3">
                            <i class="fas fa-shopping-cart fa-2x text-muted"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Shopping Cart</h6>
                            <p class="mb-0"><span id="cart-count">0</span> items - $<span id="cart-total">0.00</span></p>
                        </div>
                        <div class="ml-auto">
                            <button class="btn btn-primary" id="view-cart" disabled>View Cart</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Featured Seeds -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="section-title">Featured Seeds</h4>
        </div>
        <div class="col-12">
            <div class="featured-seeds-carousel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card seed-card featured">
                            <div class="seed-card-badge">Featured</div>
                            <div class="seed-card-vendor">Mephisto Genetics</div>
                            <img src="https://via.placeholder.com/300x200?text=Double+Grape" class="card-img-top" alt="Double Grape">
                            <div class="card-body">
                                <h5 class="card-title">Double Grape</h5>
                                <div class="seed-card-type">Autoflower</div>
                                <div class="seed-card-genetics">Sour Stomper x Grape Crinkle</div>
                                <div class="seed-card-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                    <span>(127)</span>
                                </div>
                                <div class="seed-card-price">$48.00</div>
                                <div class="seed-card-actions">
                                    <button class="btn btn-sm btn-outline-secondary">Details</button>
                                    <button class="btn btn-sm btn-primary add-to-cart" data-id="1" data-name="Double Grape" data-price="48.00">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card seed-card featured">
                            <div class="seed-card-badge">Featured</div>
                            <div class="seed-card-vendor">Barney's Farm</div>
                            <img src="https://via.placeholder.com/300x200?text=Wedding+Cake" class="card-img-top" alt="Wedding Cake">
                            <div class="card-body">
                                <h5 class="card-title">Wedding Cake</h5>
                                <div class="seed-card-type">Feminized</div>
                                <div class="seed-card-genetics">Cherry Pie x Girl Scout Cookies</div>
                                <div class="seed-card-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <span>(89)</span>
                                </div>
                                <div class="seed-card-price">$52.00</div>
                                <div class="seed-card-actions">
                                    <button class="btn btn-sm btn-outline-secondary">Details</button>
                                    <button class="btn btn-sm btn-primary add-to-cart" data-id="2" data-name="Wedding Cake" data-price="52.00">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card seed-card featured">
                            <div class="seed-card-badge">Featured</div>
                            <div class="seed-card-vendor">Dutch Passion</div>
                            <img src="https://via.placeholder.com/300x200?text=Blueberry" class="card-img-top" alt="Blueberry">
                            <div class="card-body">
                                <h5 class="card-title">Blueberry</h5>
                                <div class="seed-card-type">Regular</div>
                                <div class="seed-card-genetics">Thai x Purple Thai x Afghani</div>
                                <div class="seed-card-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <span>(156)</span>
                                </div>
                                <div class="seed-card-price">$45.00</div>
                                <div class="seed-card-actions">
                                    <button class="btn btn-sm btn-outline-secondary">Details</button>
                                    <button class="btn btn-sm btn-primary add-to-cart" data-id="3" data-name="Blueberry" data-price="45.00">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- All Seeds -->
    <div class="row">
        <div class="col-12">
            <h4 class="section-title">All Seeds</h4>
        </div>
    </div>
    
    <div class="row seed-grid" id="seed-container">
        <!-- Seed Cards will be dynamically generated here -->
        {% for i in range(1, 13) %}
        <div class="col-md-3 mb-4 seed-item" data-type="{% if i % 3 == 0 %}autoflower{% elif i % 2 == 0 %}feminized{% else %}regular{% endif %}" data-vendor="vendor-{{ (i % 3) + 1 }}">
            <div class="card seed-card">
                <div class="seed-card-vendor">{{ ['Mephisto Genetics', 'Barney\'s Farm', 'Dutch Passion'][i % 3] }}</div>
                <img src="https://via.placeholder.com/300x200?text=Seed+{{ i }}" class="card-img-top" alt="Seed {{ i }}">
                <div class="card-body">
                    <h5 class="card-title">Strain Name {{ i }}</h5>
                    <div class="seed-card-type">{% if i % 3 == 0 %}Autoflower{% elif i % 2 == 0 %}Feminized{% else %}Regular{% endif %}</div>
                    <div class="seed-card-genetics">Parent 1 x Parent 2</div>
                    <div class="seed-card-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star{% if i % 5 != 0 %}-half-alt{% endif %}"></i>
                        <i class="fa{% if i % 3 != 0 %}r{% else %}s{% endif %} fa-star"></i>
                        <span>({{ i * 10 }})</span>
                    </div>
                    <div class="seed-card-price">${{ 35 + i }}.00</div>
                    <div class="seed-card-actions">
                        <button class="btn btn-sm btn-outline-secondary">Details</button>
                        <button class="btn btn-sm btn-primary add-to-cart" data-id="{{ i + 3 }}" data-name="Strain Name {{ i }}" data-price="{{ 35 + i }}.00">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .section-title {
        margin-bottom: 1.5rem;
        font-weight: 500;
        color: var(--text-primary);
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.5rem;
    }
    
    .seed-card {
        height: 100%;
        position: relative;
        transition: transform 0.3s, box-shadow 0.3s;
        overflow: hidden;
    }
    
    .seed-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .seed-card-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--accent-color);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
        z-index: 1;
    }
    
    .seed-card-vendor {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        z-index: 1;
    }
    
    .seed-card .card-img-top {
        height: 180px;
        object-fit: cover;
        transition: transform 0.3s;
    }
    
    .seed-card:hover .card-img-top {
        transform: scale(1.05);
    }
    
    .seed-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    .seed-card-type {
        display: inline-block;
        background-color: rgba(76, 175, 80, 0.1);
        color: var(--accent-color);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
    }
    
    .seed-card-genetics {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }
    
    .seed-card-rating {
        color: #ffc107;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    
    .seed-card-rating span {
        color: var(--text-secondary);
        margin-left: 5px;
    }
    
    .seed-card-price {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1rem;
    }
    
    .seed-card-actions {
        display: flex;
        justify-content: space-between;
    }
    
    .featured-seeds-carousel {
        margin-bottom: 2rem;
    }
    
    .featured {
        border-color: var(--accent-color);
    }
    
    /* List View Styles */
    .seed-list .seed-item {
        width: 100%;
        max-width: 100%;
        flex: 0 0 100%;
    }
    
    .seed-list .seed-card {
        flex-direction: row;
    }
    
    .seed-list .seed-card .card-img-top {
        width: 150px;
        height: 150px;
        border-top-right-radius: 0;
        border-bottom-left-radius: calc(0.25rem - 1px);
    }
    
    .seed-list .seed-card .card-body {
        display: flex;
        flex-wrap: wrap;
    }
    
    .seed-list .seed-card .card-title,
    .seed-list .seed-card .seed-card-type,
    .seed-list .seed-card .seed-card-genetics {
        width: 100%;
    }
    
    .seed-list .seed-card .seed-card-rating,
    .seed-list .seed-card .seed-card-price {
        width: 50%;
    }
    
    .seed-list .seed-card .seed-card-actions {
        width: 100%;
        margin-top: auto;
    }
    
    /* Responsive adjustments */
    @media (max-width: 767.98px) {
        .seed-list .seed-card {
            flex-direction: column;
        }
        
        .seed-list .seed-card .card-img-top {
            width: 100%;
            height: 180px;
            border-top-right-radius: calc(0.25rem - 1px);
            border-bottom-left-radius: 0;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        // View toggle (Grid/List)
        $('#view-grid').click(function() {
            $(this).addClass('active');
            $('#view-list').removeClass('active');
            $('#seed-container').removeClass('seed-list').addClass('seed-grid');
        });
        
        $('#view-list').click(function() {
            $(this).addClass('active');
            $('#view-grid').removeClass('active');
            $('#seed-container').removeClass('seed-grid').addClass('seed-list');
        });
        
        // Filter functionality
        $('#filter-vendor-all').change(function() {
            $('.vendor-checkbox').prop('checked', $(this).is(':checked'));
        });
        
        $('.vendor-checkbox').change(function() {
            if (!$(this).is(':checked')) {
                $('#filter-vendor-all').prop('checked', false);
            } else if ($('.vendor-checkbox:checked').length === $('.vendor-checkbox').length) {
                $('#filter-vendor-all').prop('checked', true);
            }
        });
        
        $('#apply-filters').click(function() {
            applyFilters();
        });
        
        function applyFilters() {
            const feminized = $('#filter-feminized').is(':checked');
            const regular = $('#filter-regular').is(':checked');
            const autoflower = $('#filter-autoflower').is(':checked');
            
            const vendors = [];
            $('.vendor-checkbox:checked').each(function() {
                vendors.push($(this).attr('id').replace('filter-', ''));
            });
            
            $('.seed-item').each(function() {
                const type = $(this).data('type');
                const vendor = $(this).data('vendor');
                
                let typeMatch = false;
                if ((type === 'feminized' && feminized) || 
                    (type === 'regular' && regular) || 
                    (type === 'autoflower' && autoflower)) {
                    typeMatch = true;
                }
                
                let vendorMatch = false;
                if (vendors.includes(vendor) || $('#filter-vendor-all').is(':checked')) {
                    vendorMatch = true;
                }
                
                if (typeMatch && vendorMatch) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }
        
        // Search functionality
        $('#seed-search').on('input', function() {
            const searchTerm = $(this).val().toLowerCase();
            
            $('.seed-item').each(function() {
                const title = $(this).find('.card-title').text().toLowerCase();
                const genetics = $(this).find('.seed-card-genetics').text().toLowerCase();
                const vendor = $(this).find('.seed-card-vendor').text().toLowerCase();
                
                if (title.includes(searchTerm) || genetics.includes(searchTerm) || vendor.includes(searchTerm)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });
        
        // Shopping cart functionality
        let cart = [];
        
        $('.add-to-cart').click(function() {
            const id = $(this).data('id');
            const name = $(this).data('name');
            const price = parseFloat($(this).data('price'));
            
            // Check if item is already in cart
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: id,
                    name: name,
                    price: price,
                    quantity: 1
                });
            }
            
            updateCart();
            showToast(`Added ${name} to cart`);
        });
        
        function updateCart() {
            let totalItems = 0;
            let totalPrice = 0;
            
            cart.forEach(item => {
                totalItems += item.quantity;
                totalPrice += item.price * item.quantity;
            });
            
            $('#cart-count').text(totalItems);
            $('#cart-total').text(totalPrice.toFixed(2));
            
            if (totalItems > 0) {
                $('#view-cart').prop('disabled', false);
            } else {
                $('#view-cart').prop('disabled', true);
            }
        }
        
        $('#view-cart').click(function() {
            let cartContent = '<div class="cart-items">';
            
            cart.forEach(item => {
                cartContent += `
                    <div class="cart-item">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">$${item.price.toFixed(2)} x ${item.quantity}</div>
                        <div class="cart-item-total">$${(item.price * item.quantity).toFixed(2)}</div>
                    </div>
                `;
            });
            
            cartContent += '</div>';
            
            // In a real application, this would open a modal or navigate to a cart page
            alert('Cart Contents:\n\n' + cart.map(item => `${item.name} - $${item.price.toFixed(2)} x ${item.quantity}`).join('\n'));
        });
    });
</script>
{% endblock %}
