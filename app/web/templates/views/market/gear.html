{% extends 'common/base.html' %}

{% block title %}Gear - CultivAR{% endblock %}

{% block header %}Gear{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Filters and Search -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="flex-grow-1 mr-3">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                </div>
                                <input type="text" class="form-control" id="gear-search" placeholder="Search gear...">
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="filterDropdown">
                                <h6 class="dropdown-header">Gear Type</h6>
                                <div class="px-4 py-2">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-lights" checked>
                                        <label class="custom-control-label" for="filter-lights">Lights</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-tents" checked>
                                        <label class="custom-control-label" for="filter-tents">Grow Tents</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-nutrients" checked>
                                        <label class="custom-control-label" for="filter-nutrients">Nutrients</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-tools" checked>
                                        <label class="custom-control-label" for="filter-tools">Tools</label>
                                    </div>
                                </div>
                                <div class="dropdown-divider"></div>
                                <h6 class="dropdown-header">Brands</h6>
                                <div class="px-4 py-2">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="filter-brand-all" checked>
                                        <label class="custom-control-label" for="filter-brand-all">All Brands</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input brand-checkbox" id="filter-brand-1" checked>
                                        <label class="custom-control-label" for="filter-brand-1">AC Infinity</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input brand-checkbox" id="filter-brand-2" checked>
                                        <label class="custom-control-label" for="filter-brand-2">Spider Farmer</label>
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input brand-checkbox" id="filter-brand-3" checked>
                                        <label class="custom-control-label" for="filter-brand-3">Fox Farm</label>
                                    </div>
                                </div>
                                <div class="dropdown-divider"></div>
                                <div class="px-4 py-2">
                                    <button class="btn btn-sm btn-primary btn-block" id="apply-filters">Apply Filters</button>
                                </div>
                            </div>
                        </div>
                        <div class="ml-2">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-secondary active" id="view-grid">
                                    <i class="fas fa-th"></i>
                                </button>
                                <button type="button" class="btn btn-outline-secondary" id="view-list">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="mr-3">
                            <i class="fas fa-shopping-cart fa-2x text-muted"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Shopping Cart</h6>
                            <p class="mb-0"><span id="cart-count">0</span> items - $<span id="cart-total">0.00</span></p>
                        </div>
                        <div class="ml-auto">
                            <button class="btn btn-primary" id="view-cart" disabled>View Cart</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Featured Gear -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="section-title">Featured Gear</h4>
        </div>
        <div class="col-12">
            <div class="featured-gear-carousel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card gear-card featured">
                            <div class="gear-card-badge">Featured</div>
                            <div class="gear-card-brand">AC Infinity</div>
                            <img src="https://via.placeholder.com/300x200?text=CLOUDLINE+T6" class="card-img-top" alt="CLOUDLINE T6">
                            <div class="card-body">
                                <h5 class="card-title">CLOUDLINE T6 Inline Duct Fan</h5>
                                <div class="gear-card-type">Ventilation</div>
                                <div class="gear-card-description">6-inch inline duct fan with temperature and humidity controller</div>
                                <div class="gear-card-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                    <span>(142)</span>
                                </div>
                                <div class="gear-card-price">$149.99</div>
                                <div class="gear-card-actions">
                                    <button class="btn btn-sm btn-outline-secondary">Details</button>
                                    <button class="btn btn-sm btn-primary add-to-cart" data-id="1" data-name="CLOUDLINE T6 Inline Duct Fan" data-price="149.99">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card gear-card featured">
                            <div class="gear-card-badge">Featured</div>
                            <div class="gear-card-brand">Spider Farmer</div>
                            <img src="https://via.placeholder.com/300x200?text=SF-2000" class="card-img-top" alt="SF-2000">
                            <div class="card-body">
                                <h5 class="card-title">SF-2000 LED Grow Light</h5>
                                <div class="gear-card-type">Lights</div>
                                <div class="gear-card-description">200W LED grow light with Samsung LM301B diodes</div>
                                <div class="gear-card-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <span>(98)</span>
                                </div>
                                <div class="gear-card-price">$299.99</div>
                                <div class="gear-card-actions">
                                    <button class="btn btn-sm btn-outline-secondary">Details</button>
                                    <button class="btn btn-sm btn-primary add-to-cart" data-id="2" data-name="SF-2000 LED Grow Light" data-price="299.99">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card gear-card featured">
                            <div class="gear-card-badge">Featured</div>
                            <div class="gear-card-brand">Fox Farm</div>
                            <img src="https://via.placeholder.com/300x200?text=Nutrient+Trio" class="card-img-top" alt="Nutrient Trio">
                            <div class="card-body">
                                <h5 class="card-title">Liquid Nutrient Trio</h5>
                                <div class="gear-card-type">Nutrients</div>
                                <div class="gear-card-description">Grow Big, Tiger Bloom, and Big Bloom liquid fertilizers</div>
                                <div class="gear-card-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <span>(215)</span>
                                </div>
                                <div class="gear-card-price">$49.95</div>
                                <div class="gear-card-actions">
                                    <button class="btn btn-sm btn-outline-secondary">Details</button>
                                    <button class="btn btn-sm btn-primary add-to-cart" data-id="3" data-name="Liquid Nutrient Trio" data-price="49.95">Add to Cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- All Gear -->
    <div class="row">
        <div class="col-12">
            <h4 class="section-title">All Gear</h4>
        </div>
    </div>
    
    <div class="row gear-grid" id="gear-container">
        <!-- Gear Cards will be dynamically generated here -->
        {% for i in range(1, 13) %}
        <div class="col-md-3 mb-4 gear-item" 
             data-type="{% if i % 4 == 0 %}tools{% elif i % 3 == 0 %}nutrients{% elif i % 2 == 0 %}tents{% else %}lights{% endif %}" 
             data-brand="brand-{{ (i % 3) + 1 }}">
            <div class="card gear-card">
                <div class="gear-card-brand">{{ ['AC Infinity', 'Spider Farmer', 'Fox Farm'][i % 3] }}</div>
                <img src="https://via.placeholder.com/300x200?text=Gear+{{ i }}" class="card-img-top" alt="Gear {{ i }}">
                <div class="card-body">
                    <h5 class="card-title">Gear Item {{ i }}</h5>
                    <div class="gear-card-type">
                        {% if i % 4 == 0 %}Tools{% elif i % 3 == 0 %}Nutrients{% elif i % 2 == 0 %}Grow Tents{% else %}Lights{% endif %}
                    </div>
                    <div class="gear-card-description">Description for gear item {{ i }}</div>
                    <div class="gear-card-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star{% if i % 5 != 0 %}-half-alt{% endif %}"></i>
                        <i class="fa{% if i % 3 != 0 %}r{% else %}s{% endif %} fa-star"></i>
                        <span>({{ i * 12 }})</span>
                    </div>
                    <div class="gear-card-price">${{ 29.99 + (i * 10) }}</div>
                    <div class="gear-card-actions">
                        <button class="btn btn-sm btn-outline-secondary">Details</button>
                        <button class="btn btn-sm btn-primary add-to-cart" data-id="{{ i + 3 }}" data-name="Gear Item {{ i }}" data-price="{{ 29.99 + (i * 10) }}">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .section-title {
        margin-bottom: 1.5rem;
        font-weight: 500;
        color: var(--text-primary);
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.5rem;
    }
    
    .gear-card {
        height: 100%;
        position: relative;
        transition: transform 0.3s, box-shadow 0.3s;
        overflow: hidden;
    }
    
    .gear-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .gear-card-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--accent-color);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
        z-index: 1;
    }
    
    .gear-card-brand {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        z-index: 1;
    }
    
    .gear-card .card-img-top {
        height: 180px;
        object-fit: cover;
        transition: transform 0.3s;
    }
    
    .gear-card:hover .card-img-top {
        transform: scale(1.05);
    }
    
    .gear-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    .gear-card-type {
        display: inline-block;
        background-color: rgba(76, 175, 80, 0.1);
        color: var(--accent-color);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-bottom: 0.5rem;
    }
    
    .gear-card-description {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }
    
    .gear-card-rating {
        color: #ffc107;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    
    .gear-card-rating span {
        color: var(--text-secondary);
        margin-left: 5px;
    }
    
    .gear-card-price {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1rem;
    }
    
    .gear-card-actions {
        display: flex;
        justify-content: space-between;
    }
    
    .featured-gear-carousel {
        margin-bottom: 2rem;
    }
    
    .featured {
        border-color: var(--accent-color);
    }
    
    /* List View Styles */
    .gear-list .gear-item {
        width: 100%;
        max-width: 100%;
        flex: 0 0 100%;
    }
    
    .gear-list .gear-card {
        flex-direction: row;
    }
    
    .gear-list .gear-card .card-img-top {
        width: 150px;
        height: 150px;
        border-top-right-radius: 0;
        border-bottom-left-radius: calc(0.25rem - 1px);
    }
    
    .gear-list .gear-card .card-body {
        display: flex;
        flex-wrap: wrap;
    }
    
    .gear-list .gear-card .card-title,
    .gear-list .gear-card .gear-card-type,
    .gear-list .gear-card .gear-card-description {
        width: 100%;
    }
    
    .gear-list .gear-card .gear-card-rating,
    .gear-list .gear-card .gear-card-price {
        width: 50%;
    }
    
    .gear-list .gear-card .gear-card-actions {
        width: 100%;
        margin-top: auto;
    }
    
    /* Responsive adjustments */
    @media (max-width: 767.98px) {
        .gear-list .gear-card {
            flex-direction: column;
        }
        
        .gear-list .gear-card .card-img-top {
            width: 100%;
            height: 180px;
            border-top-right-radius: calc(0.25rem - 1px);
            border-bottom-left-radius: 0;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        // View toggle (Grid/List)
        $('#view-grid').click(function() {
            $(this).addClass('active');
            $('#view-list').removeClass('active');
            $('#gear-container').removeClass('gear-list').addClass('gear-grid');
        });
        
        $('#view-list').click(function() {
            $(this).addClass('active');
            $('#view-grid').removeClass('active');
            $('#gear-container').removeClass('gear-grid').addClass('gear-list');
        });
        
        // Filter functionality
        $('#filter-brand-all').change(function() {
            $('.brand-checkbox').prop('checked', $(this).is(':checked'));
        });
        
        $('.brand-checkbox').change(function() {
            if (!$(this).is(':checked')) {
                $('#filter-brand-all').prop('checked', false);
            } else if ($('.brand-checkbox:checked').length === $('.brand-checkbox').length) {
                $('#filter-brand-all').prop('checked', true);
            }
        });
        
        $('#apply-filters').click(function() {
            applyFilters();
        });
        
        function applyFilters() {
            const lights = $('#filter-lights').is(':checked');
            const tents = $('#filter-tents').is(':checked');
            const nutrients = $('#filter-nutrients').is(':checked');
            const tools = $('#filter-tools').is(':checked');
            
            const brands = [];
            $('.brand-checkbox:checked').each(function() {
                brands.push($(this).attr('id').replace('filter-', ''));
            });
            
            $('.gear-item').each(function() {
                const type = $(this).data('type');
                const brand = $(this).data('brand');
                
                let typeMatch = false;
                if ((type === 'lights' && lights) || 
                    (type === 'tents' && tents) || 
                    (type === 'nutrients' && nutrients) ||
                    (type === 'tools' && tools)) {
                    typeMatch = true;
                }
                
                let brandMatch = false;
                if (brands.includes(brand) || $('#filter-brand-all').is(':checked')) {
                    brandMatch = true;
                }
                
                if (typeMatch && brandMatch) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }
        
        // Search functionality
        $('#gear-search').on('input', function() {
            const searchTerm = $(this).val().toLowerCase();
            
            $('.gear-item').each(function() {
                const title = $(this).find('.card-title').text().toLowerCase();
                const description = $(this).find('.gear-card-description').text().toLowerCase();
                const brand = $(this).find('.gear-card-brand').text().toLowerCase();
                
                if (title.includes(searchTerm) || description.includes(searchTerm) || brand.includes(searchTerm)) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });
        
        // Shopping cart functionality
        let cart = [];
        
        $('.add-to-cart').click(function() {
            const id = $(this).data('id');
            const name = $(this).data('name');
            const price = parseFloat($(this).data('price'));
            
            // Check if item is already in cart
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: id,
                    name: name,
                    price: price,
                    quantity: 1
                });
            }
            
            updateCart();
            showToast(`Added ${name} to cart`);
        });
        
        function updateCart() {
            let totalItems = 0;
            let totalPrice = 0;
            
            cart.forEach(item => {
                totalItems += item.quantity;
                totalPrice += item.price * item.quantity;
            });
            
            $('#cart-count').text(totalItems);
            $('#cart-total').text(totalPrice.toFixed(2));
            
            if (totalItems > 0) {
                $('#view-cart').prop('disabled', false);
            } else {
                $('#view-cart').prop('disabled', true);
            }
        }
        
        $('#view-cart').click(function() {
            let cartContent = '<div class="cart-items">';
            
            cart.forEach(item => {
                cartContent += `
                    <div class="cart-item">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">$${item.price.toFixed(2)} x ${item.quantity}</div>
                        <div class="cart-item-total">$${(item.price * item.quantity).toFixed(2)}</div>
                    </div>
                `;
            });
            
            cartContent += '</div>';
            
            // In a real application, this would open a modal or navigate to a cart page
            alert('Cart Contents:\n\n' + cart.map(item => `${item.name} - $${item.price.toFixed(2)} x ${item.quantity}`).join('\n'));
        });
    });
</script>
{% endblock %}
